{
  "django__django-11179": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-11179",
    "model_patch": "diff --git a/django/db/models/deletion.py b/django/db/models/deletion.py\nindex 92fe4affb9..b798238e88 100644\n--- a/django/db/models/deletion.py\n+++ b/django/db/models/deletion.py\n@@ -277,6 +277,9 @@ class Collector:\n             if self.can_fast_delete(instance):\n                 with transaction.mark_for_rollback_on_error():\n                     count = sql.DeleteQuery(model).delete_batch([instance.pk], self.using)\n+                # Clear the instance PK like in the full delete path so that\n+                # instance.delete() results in instance.pk being None.\n+                setattr(instance, model._meta.pk.attname, None)\n                 return count, {model._meta.label: count}\n \n         with transaction.atomic(using=self.using, savepoint=False):\n"
  },
  "django__django-16662": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-16662",
    "model_patch": "diff --git a/django/db/migrations/writer.py b/django/db/migrations/writer.py\nindex a59f0c8dcb..3d25ce7b0c 100644\n--- a/django/db/migrations/writer.py\n+++ b/django/db/migrations/writer.py\n@@ -175,7 +175,7 @@ class MigrationWriter:\n \n         # Sort imports by the package / module to be imported (the part after\n         # \"from\" in \"from ... import ...\" or after \"import\" in \"import ...\").\n-        sorted_imports = sorted(imports, key=lambda i: i.split()[1])\n+        sorted_imports = sorted(imports, key=lambda i: (0 if i.startswith('import ') else 1, i.split()[1]))\n         items[\"imports\"] = \"\\n\".join(sorted_imports) + \"\\n\" if imports else \"\"\n         if migration_imports:\n             items[\"imports\"] += (\n"
  },
  "django__django-14053": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-14053",
    "model_patch": "diff --git a/django/contrib/staticfiles/storage.py b/django/contrib/staticfiles/storage.py\nindex 494890cc23..33f57979dd 100644\n--- a/django/contrib/staticfiles/storage.py\n+++ b/django/contrib/staticfiles/storage.py\n@@ -228,7 +228,13 @@ class HashedFilesMixin:\n         ]\n         # Do a single pass first. Post-process all files once, then repeat for\n         # adjustable files.\n+        # Track names that have already been yielded to avoid duplicate yields for\n+        # the same original file when multiple passes are necessary.\n+        yielded = set()\n         for name, hashed_name, processed, _ in self._post_process(paths, adjustable_paths, hashed_files):\n+            if name in yielded:\n+                continue\n+            yielded.add(name)\n             yield name, hashed_name, processed\n \n         paths = {path: paths[path] for path in adjustable_paths}\n@@ -236,8 +242,13 @@ class HashedFilesMixin:\n         for i in range(self.max_post_process_passes):\n             substitutions = False\n             for name, hashed_name, processed, subst in self._post_process(paths, adjustable_paths, hashed_files):\n-                yield name, hashed_name, processed\n+                # Always account for whether substitutions occurred, even if we're\n+                # skipping yielding this name because it was already yielded.\n                 substitutions = substitutions or subst\n+                if name in yielded:\n+                    continue\n+                yielded.add(name)\n+                yield name, hashed_name, processed\n \n             if not substitutions:\n                 break\n"
  },
  "django__django-14011": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-14011",
    "model_patch": "diff --git a/django/core/servers/basehttp.py b/django/core/servers/basehttp.py\nindex 14dab517c9..7bea6b8cc6 100644\n--- a/django/core/servers/basehttp.py\n+++ b/django/core/servers/basehttp.py\n@@ -79,7 +79,11 @@ class WSGIServer(simple_server.WSGIServer):\n \n class ThreadedWSGIServer(socketserver.ThreadingMixIn, WSGIServer):\n     \"\"\"A threaded version of the WSGIServer\"\"\"\n-    daemon_threads = True\n+    # Use non-daemon worker threads so the server waits for them to finish\n+    # during shutdown. Daemon threads may be terminated abruptly which can\n+    # prevent per-thread cleanup (for example, closing DB connections),\n+    # leading to issues when tearing down test databases.\n+    daemon_threads = False\n \n \n class ServerHandler(simple_server.ServerHandler):\n"
  },
  "django__django-13810": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-13810",
    "model_patch": "diff --git a/django/core/handlers/base.py b/django/core/handlers/base.py\nindex 8e8c3da06a..ef1c99b99a 100644\n--- a/django/core/handlers/base.py\n+++ b/django/core/handlers/base.py\n@@ -51,11 +51,15 @@ class BaseHandler:\n                 middleware_is_async = middleware_can_async\n             try:\n                 # Adapt handler, if needed.\n-                handler = self.adapt_method_mode(\n+                # Do not overwrite `handler` until middleware(...) succeeds,\n+                # otherwise MiddlewareNotUsed raised by the middleware factory\n+                # would leave the adapted handler in place and \"poison\"\n+                # the next middleware in the loop.\n+                adapted_handler = self.adapt_method_mode(\n                     middleware_is_async, handler, handler_is_async,\n                     debug=settings.DEBUG, name='middleware %s' % middleware_path,\n                 )\n-                mw_instance = middleware(handler)\n+                mw_instance = middleware(adapted_handler)\n             except MiddlewareNotUsed as exc:\n                 if settings.DEBUG:\n                     if str(exc):\n"
  },
  "scikit-learn__scikit-learn-26323": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "scikit-learn__scikit-learn-26323",
    "model_patch": "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex 4eddd12b1..83ee20cf1 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -293,14 +293,30 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n-            trans\n-            for _, trans, _ in chain(\n-                self.transformers, getattr(self, \"transformers_\", [])\n-            )\n-            if trans not in {\"passthrough\", \"drop\"}\n-        )\n-        for trans in transformers:\n+\n+        # Collect all transformers the user provided (unfitted), any fitted\n+        # transformers (transformers_), and also the remainder estimator when it\n+        # is an estimator (and not one of the special strings). This ensures\n+        # that calling set_output before fit also configures the remainder.\n+        transformers_list = []\n+        transformers_list.extend(list(self.transformers))\n+        transformers_list.extend(list(getattr(self, \"transformers_\", [])))\n+\n+        # If remainder is an estimator (and not 'passthrough' or 'drop'),\n+        # include it when not already present. We use the name 'remainder'\n+        # to avoid duplicating when transformers_ already contains it.\n+        try:\n+            remainder = self.remainder\n+        except AttributeError:\n+            remainder = None\n+\n+        if remainder is not None and remainder not in {\"passthrough\", \"drop\"}:\n+            if not any(name == \"remainder\" for name, _, *_ in transformers_list):\n+                transformers_list.append((\"remainder\", remainder, None))\n+\n+        for _, trans, _ in transformers_list:\n+            if trans in {\"passthrough\", \"drop\"}:\n+                continue\n             _safe_set_output(trans, transform=transform)\n \n         return self\n"
  },
  "django__django-7530": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-7530",
    "model_patch": "diff --git a/django/core/management/commands/makemigrations.py b/django/core/management/commands/makemigrations.py\nindex 0b39536f5b..e648880ef0 100644\n--- a/django/core/management/commands/makemigrations.py\n+++ b/django/core/management/commands/makemigrations.py\n@@ -105,7 +105,7 @@ class Command(BaseCommand):\n                     # At least one model must be migrated to the database.\n                     router.allow_migrate(connection.alias, app_label, model_name=model._meta.object_name)\n                     for app_label in consistency_check_labels\n-                    for model in apps.get_models(app_label)\n+                    for model in apps.get_app_config(app_label).get_models()\n             )):\n                 loader.check_consistent_history(connection)\n \n"
  },
  "sphinx-doc__sphinx-9230": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "sphinx-doc__sphinx-9230",
    "model_patch": "*** Begin Patch\n*** Update File: sphinx/ext/napoleon/docstring.py\n@@\n-        if parse_type:\n-            match = _google_typed_arg_regex.match(before)\n-            if match:\n-                _name = match.group(1).strip()\n-                _type = match.group(2)\n+        if parse_type:\n+            match = _google_typed_arg_regex.match(before)\n+            if match:\n+                _name = match.group(1).strip()\n+                _type = match.group(2)\n+            else:\n+                # Allow the form \"type name\" (e.g. \"dict(str, str) opc_meta\")\n+                # as some authors write the type before the parameter name.\n+                # Split on the last whitespace and if the left side looks like\n+                # a parenthesized type (ends with ')'), treat it as the type.\n+                if ' ' in before:\n+                    parts = before.rsplit(' ', 1)\n+                    if parts and parts[0].strip().endswith(')') and parts[1].strip():\n+                        _type = parts[0].strip()\n+                        _name = parts[1].strip()\n*** End Patch\n*** End Patch\n\nNo changes detected to generate a patch."
  },
  "sympy__sympy-24213": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "sympy__sympy-24213",
    "model_patch": "diff --git a/sympy/physics/units/unitsystem.py b/sympy/physics/units/unitsystem.py\nindex a436880c4b..5925f927bb 100644\n--- a/sympy/physics/units/unitsystem.py\n+++ b/sympy/physics/units/unitsystem.py\n@@ -176,10 +176,18 @@ def _collect_factor_and_dimension(self, expr):\n                 addend_factor, addend_dim = \\\n                     self._collect_factor_and_dimension(addend)\n                 if dim != addend_dim:\n-                    raise ValueError(\n-                        'Dimension of \"{}\" is {}, '\n-                        'but it should be {}'.format(\n-                            addend, addend_dim, dim))\n+                    # Allow addition when the dimension system considers the\n+                    # two dimensions equivalent (for example velocity and\n+                    # acceleration*time). In that case, treat them as the\n+                    # same dimension for the purposes of addition.\n+                    if self.get_dimension_system().equivalent_dims(dim, addend_dim):\n+                        # equivalent dimensions: proceed to add the numeric factors\n+                        pass\n+                    else:\n+                        raise ValueError(\n+                            'Dimension of \"{}\" is {}, '\n+                            'but it should be {}'.format(\n+                                addend, addend_dim, dim))\n                 factor += addend_factor\n             return factor, dim\n         elif isinstance(expr, Derivative):\n"
  },
  "django__django-13297": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-13297",
    "model_patch": "diff --git a/django/views/generic/base.py b/django/views/generic/base.py\nindex ea5baca08d..bd1414b485 100644\n--- a/django/views/generic/base.py\n+++ b/django/views/generic/base.py\n@@ -27,6 +27,23 @@ class ContextMixin:\n         kwargs.setdefault('view', self)\n         if self.extra_context is not None:\n             kwargs.update(self.extra_context)\n+        # Ensure SimpleLazyObject values are resolved to their underlying\n+        # objects when returning the context. URL kwargs are wrapped in\n+        # SimpleLazyObject (see _wrap_url_kwargs_with_deprecation_warning),\n+        # and leaving them as lazy proxies can cause unexpected type errors\n+        # when view code uses those values (for example passing them to ORM\n+        # filters). Force evaluation and replace the proxy with the wrapped\n+        # object where possible.\n+        for key, value in list(kwargs.items()):\n+            if isinstance(value, SimpleLazyObject):\n+                try:\n+                    # Force evaluation of the lazy object. _setup will populate\n+                    # _wrapped with the actual value.\n+                    value._setup()\n+                except Exception:\n+                    # If setup fails for any reason, leave the lazy object as-is.\n+                    continue\n+                kwargs[key] = getattr(value, '_wrapped', value)\n         return kwargs\n \n \n"
  },
  "astropy__astropy-7166": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "astropy__astropy-7166",
    "model_patch": "diff --git a/astropy/utils/misc.py b/astropy/utils/misc.py\nindex de3fb01d1..464cb76e9 100644\n--- a/astropy/utils/misc.py\n+++ b/astropy/utils/misc.py\n@@ -528,16 +528,43 @@ class InheritDocstrings(type):\n                 not key.startswith('_'))\n \n         for key, val in dct.items():\n-            if (inspect.isfunction(val) and\n-                is_public_member(key) and\n-                val.__doc__ is None):\n-                for base in cls.__mro__[1:]:\n-                    super_method = getattr(base, key, None)\n-                    if super_method is not None:\n-                        val.__doc__ = super_method.__doc__\n-                        break\n-\n-        super().__init__(name, bases, dct)\n+            if not is_public_member(key):\n+                continue\n+\n+            # Plain functions: inherit docstring if missing\n+            if inspect.isfunction(val):\n+                if val.__doc__ is None:\n+                    for base in cls.__mro__[1:]:\n+                        super_method = getattr(base, key, None)\n+                        if super_method is not None:\n+                            val.__doc__ = super_method.__doc__\n+                            break\n+\n+            # Properties: create a new property with inherited docstring\n+            elif isinstance(val, property):\n+                if val.__doc__ is None:\n+                    for base in cls.__mro__[1:]:\n+                        super_method = getattr(base, key, None)\n+                        if super_method is not None:\n+                            doc = getattr(super_method, '__doc__', None)\n+                            if doc:\n+                                new_prop = property(val.fget, val.fset, val.fdel, doc)\n+                                # set on the class so the descriptor is updated\n+                                setattr(cls, key, new_prop)\n+                                break\n+\n+            # classmethod/staticmethod: update the underlying function's docstring\n+            elif isinstance(val, (classmethod, staticmethod)):\n+                func = val.__func__\n+                if func.__doc__ is None:\n+                    for base in cls.__mro__[1:]:\n+                        super_method = getattr(base, key, None)\n+                        if super_method is not None:\n+                            doc = getattr(super_method, '__doc__', None)\n+                            if doc:\n+                                func.__doc__ = doc\n+                                break\n+\n \n \n class OrderedDescriptor(metaclass=abc.ABCMeta):\n"
  },
  "django__django-10973": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-10973",
    "model_patch": "diff --git a/django/db/backends/postgresql/client.py b/django/db/backends/postgresql/client.py\nindex 7fca6eff30..e623a041f0 100644\n--- a/django/db/backends/postgresql/client.py\n+++ b/django/db/backends/postgresql/client.py\n@@ -2,7 +2,6 @@ import os\n import signal\n import subprocess\n \n-from django.core.files.temp import NamedTemporaryFile\n from django.db.backends.base.client import BaseDatabaseClient\n \n \n@@ -34,38 +33,23 @@ class DatabaseClient(BaseDatabaseClient):\n             args += ['-p', str(port)]\n         args += [dbname]\n \n-        temp_pgpass = None\n+        # Prepare a custom environment for the subprocess so we don't need to\n+        # rely on global os.environ side effects. Use PGPASSWORD if a password\n+        # is provided. Keep SIGINT handling behavior (ignored in Python so it's\n+        # passed to the child process).\n+        env = os.environ.copy()\n+        if passwd:\n+            env['PGPASSWORD'] = passwd\n         sigint_handler = signal.getsignal(signal.SIGINT)\n         try:\n-            if passwd:\n-                # Create temporary .pgpass file.\n-                temp_pgpass = NamedTemporaryFile(mode='w+')\n-                try:\n-                    print(\n-                        _escape_pgpass(host) or '*',\n-                        str(port) or '*',\n-                        _escape_pgpass(dbname) or '*',\n-                        _escape_pgpass(user) or '*',\n-                        _escape_pgpass(passwd),\n-                        file=temp_pgpass,\n-                        sep=':',\n-                        flush=True,\n-                    )\n-                    os.environ['PGPASSFILE'] = temp_pgpass.name\n-                except UnicodeEncodeError:\n-                    # If the current locale can't encode the data, let the\n-                    # user input the password manually.\n-                    pass\n             # Allow SIGINT to pass to psql to abort queries.\n             signal.signal(signal.SIGINT, signal.SIG_IGN)\n-            subprocess.check_call(args)\n+            # Use subprocess.run with check=True to mirror check_call behavior\n+            # while allowing us to pass a custom environment.\n+            subprocess.run(args, env=env, check=True)\n         finally:\n             # Restore the original SIGINT handler.\n             signal.signal(signal.SIGINT, sigint_handler)\n-            if temp_pgpass:\n-                temp_pgpass.close()\n-                if 'PGPASSFILE' in os.environ:  # unit tests need cleanup\n-                    del os.environ['PGPASSFILE']\n \n     def runshell(self):\n         DatabaseClient.runshell_db(self.connection.get_connection_params())\n"
  },
  "django__django-12406": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-12406",
    "model_patch": "diff --git a/django/forms/models.py b/django/forms/models.py\nindex dafc11f995..5a9de41502 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -1147,7 +1147,15 @@ class ModelChoiceIterator:\n \n     def __iter__(self):\n         if self.field.empty_label is not None:\n-            yield (\"\", self.field.empty_label)\n+            # Radio widgets have an intrinsic \"unfilled\" state (no radio selected),\n+            # so rendering an explicit empty choice (e.g. \"---------\") is\n+            # confusing when the field is required (model.blank is False).\n+            # Avoid adding the empty choice for radio widgets when the field\n+            # is required. For other widgets (e.g. <select>), keep the empty\n+            # choice behavior for compatibility.\n+            widget_input_type = getattr(self.field.widget, 'input_type', None)\n+            if not (widget_input_type == 'radio' and self.field.required):\n+                yield (\"\", self.field.empty_label)\n         queryset = self.queryset\n         # Can't use iterator() when queryset uses prefetch_related()\n         if not queryset._prefetch_related_lookups:\n"
  },
  "psf__requests-2931": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "psf__requests-2931",
    "model_patch": "diff --git a/requests/utils.py b/requests/utils.py\nindex 132cd2b..3652c90 100644\n--- a/requests/utils.py\n+++ b/requests/utils.py\n@@ -689,19 +689,25 @@ def to_native_string(string, encoding='ascii'):\n     string in the native string type, encoding and decoding where necessary.\n     This assumes ASCII unless told otherwise.\n     \"\"\"\n-    out = None\n-\n+    # If it's already the native string type, just return it.\n     if isinstance(string, builtin_str):\n-        out = string\n-    else:\n-        if is_py2:\n-            out = string.encode(encoding)\n-        else:\n-            out = string.decode(encoding)\n+        return string\n \n-    return out\n+    # Python 2: encode unicode to bytes using the given encoding.\n+    if is_py2:\n+        return string.encode(encoding)\n \n+    # Python 3: avoid decoding arbitrary bytes into text. Decoding binary payloads\n+    # with ASCII will raise. Attempt to decode bytes using the given encoding;\n+    # if decoding fails, return the original bytes unchanged to preserve binary data.\n+    if isinstance(string, bytes):\n+        try:\n+            return string.decode(encoding)\n+        except UnicodeDecodeError:\n+            return string\n \n+    # Fallback: coerce to native str.\n+    return str(string)\n def urldefragauth(url):\n     \"\"\"\n     Given a url remove the fragment and the authentication part\n"
  },
  "psf__requests-1921": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "psf__requests-1921",
    "model_patch": "diff --git a/requests/sessions.py b/requests/sessions.py\nindex a023e4e..5da546e 100644\n--- a/requests/sessions.py\n+++ b/requests/sessions.py\n@@ -54,8 +54,12 @@ def merge_setting(request_setting, session_setting, dict_class=OrderedDict):\n     merged_setting = dict_class(to_key_val_list(session_setting))\n     merged_setting.update(to_key_val_list(request_setting))\n \n-    # Remove keys that are set to None.\n-    for (k, v) in request_setting.items():\n+    # Remove keys that are set to None in the merged result.\n+    # If a key is explicitly set to None in either the session settings\n+    # or the request settings, it should be omitted from the final mapping.\n+    # (This handles the common case of session.headers['Some-Header'] = None\n+    # meaning \"do not send this header\".)\n+    for (k, v) in list(merged_setting.items()):\n         if v is None:\n             del merged_setting[k]\n \n"
  },
  "sphinx-doc__sphinx-7590": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "sphinx-doc__sphinx-7590",
    "model_patch": "*** Begin Patch\n*** Update File: sphinx/domains/cpp.py\n@@\n class ASTStringLiteral(ASTLiteral):\n     def __init__(self, data: str) -> None:\n         self.data = data\n@@\n     def describe_signature(self, signode: TextElement, mode: str,\n                            env: \"BuildEnvironment\", symbol: \"Symbol\") -> None:\n         txt = str(self)\n         signode.append(nodes.Text(txt, txt))\n \n \n class ASTCharLiteral(ASTLiteral):\n     def __init__(self, prefix: str, data: str) -> None:\n         self.prefix = prefix  # may be None when no prefix\n         self.data = data\n         assert prefix in _id_char_from_prefix\n         self.type = _id_char_from_prefix[prefix]\n         decoded = data.encode().decode('unicode-escape')\n         if len(decoded) == 1:\n             self.value = ord(decoded)\n         else:\n             raise UnsupportedMultiCharacterCharLiteral(decoded)\n@@\n         signode.append(nodes.Text(txt, txt))\n \n+\n+class ASTUserDefinedLiteral(ASTLiteral):\n+    \"\"\"Represents a user-defined literal (literal + identifier suffix).\"\"\"\n+    def __init__(self, data: str) -> None:\n+        self.data = data\n+\n+    def _stringify(self, transform: StringifyTransform) -> str:\n+        return self.data\n+\n+    def get_id(self, version: int) -> str:\n+        return str(self.data)\n+\n+    def describe_signature(self, signode: TextElement, mode: str,\n+                           env: \"BuildEnvironment\", symbol: \"Symbol\") -> None:\n+        signode.append(nodes.Text(self.data, self.data))\n+\n*** End Patch\n\nNo changes detected to generate a patch."
  },
  "pytest-dev__pytest-7490": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "pytest-dev__pytest-7490",
    "model_patch": "*** Begin Patch\n*** Update File: src/_pytest/skipping.py\n@@\n def pytest_runtest_makereport(item: Item, call: CallInfo[None]):\n     outcome = yield\n     rep = outcome.get_result()\n-    xfailed = item._store.get(xfailed_key, None)\n+    # Refresh xfail evaluation here if it hasn't been evaluated yet\n+    # This ensures markers that were added dynamically during the test\n+    # (e.g. via request.node.add_marker(pytest.mark.xfail(...))) are\n+    # taken into account when building the report.\n+    xfailed = item._store.get(xfailed_key, None)\n+    if xfailed is None:\n+        xfailed = evaluate_xfail_marks(item)\n+        item._store[xfailed_key] = xfailed\n*** End Patch\n\nNo changes detected to generate a patch."
  },
  "django__django-16631": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-16631",
    "model_patch": "diff --git a/django/contrib/auth/__init__.py b/django/contrib/auth/__init__.py\nindex 155330c596..1993157f45 100644\n--- a/django/contrib/auth/__init__.py\n+++ b/django/contrib/auth/__init__.py\n@@ -5,7 +5,7 @@ from django.apps import apps as django_apps\n from django.conf import settings\n from django.core.exceptions import ImproperlyConfigured, PermissionDenied\n from django.middleware.csrf import rotate_token\n-from django.utils.crypto import constant_time_compare\n+from django.utils.crypto import constant_time_compare, salted_hmac\n from django.utils.module_loading import import_string\n from django.views.decorators.debug import sensitive_variables\n \n@@ -16,7 +16,6 @@ BACKEND_SESSION_KEY = \"_auth_user_backend\"\n HASH_SESSION_KEY = \"_auth_user_hash\"\n REDIRECT_FIELD_NAME = \"next\"\n \n-\n def load_backend(path):\n     return import_string(path)()\n \n@@ -60,7 +59,6 @@ def _get_user_session_key(request):\n     return get_user_model()._meta.pk.to_python(request.session[SESSION_KEY])\n \n \n-@sensitive_variables(\"credentials\")\n def authenticate(request=None, **credentials):\n     \"\"\"\n     If the given credentials are valid, return a User object.\n@@ -106,9 +104,7 @@ def login(request, user, backend=None):\n     if SESSION_KEY in request.session:\n         if _get_user_session_key(request) != user.pk or (\n             session_auth_hash\n-            and not constant_time_compare(\n-                request.session.get(HASH_SESSION_KEY, \"\"), session_auth_hash\n-            )\n+            and not _session_auth_hash_matches(request.session.get(HASH_SESSION_KEY, \"\"), user)\n         ):\n             # To avoid reusing another user's session, create a new, empty\n             # session if the existing session corresponds to a different\n@@ -199,9 +195,7 @@ def get_user(request):\n             # Verify the session\n             if hasattr(user, \"get_session_auth_hash\"):\n                 session_hash = request.session.get(HASH_SESSION_KEY)\n-                session_hash_verified = session_hash and constant_time_compare(\n-                    session_hash, user.get_session_auth_hash()\n-                )\n+                session_hash_verified = _session_auth_hash_matches(session_hash, user)\n                 if not session_hash_verified:\n                     request.session.flush()\n                     user = None\n@@ -228,3 +222,39 @@ def update_session_auth_hash(request, user):\n     request.session.cycle_key()\n     if hasattr(user, \"get_session_auth_hash\") and request.user == user:\n         request.session[HASH_SESSION_KEY] = user.get_session_auth_hash()\n+\n+\n+def _session_auth_hash_matches(session_hash, user):\n+    \"\"\"\n+    Return True if the provided session_hash matches the user's session auth\n+    hash using the current SECRET_KEY or any key in SECRET_KEY_FALLBACKS.\n+\n+    This preserves sessions across SECRET_KEY rotations where the previous\n+    keys have been added to SECRET_KEY_FALLBACKS.\n+    \"\"\"\n+    if not session_hash:\n+        return False\n+    # First try the current key (use the existing API on the user)\n+    try:\n+        current = user.get_session_auth_hash()\n+    except Exception:\n+        current = None\n+    if current and constant_time_compare(session_hash, current):\n+        return True\n+\n+    # If there are fallbacks, try them\n+    fallbacks = getattr(settings, \"SECRET_KEY_FALLBACKS\", None) or []\n+    if not fallbacks:\n+        return False\n+\n+    key_salt = \"django.contrib.auth.models.AbstractBaseUser.get_session_auth_hash\"\n+    # Try each fallback secret\n+    for secret in fallbacks:\n+        try:\n+            expected = salted_hmac(key_salt, user.password, secret=secret, algorithm=\"sha256\").hexdigest()\n+        except Exception:\n+            # Ignore malformed secrets or other errors and continue trying others.\n+            continue\n+        if constant_time_compare(session_hash, expected):\n+            return True\n+    return False\n"
  },
  "sympy__sympy-17655": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "sympy__sympy-17655",
    "model_patch": "diff --git a/sympy/geometry/entity.py b/sympy/geometry/entity.py\nindex ee5c910268..2d19ae9cad 100644\n--- a/sympy/geometry/entity.py\n+++ b/sympy/geometry/entity.py\n@@ -138,8 +138,37 @@ def __repr__(self):\n         return type(self).__name__ + repr(self.args)\n \n     def __rmul__(self, a):\n-        \"\"\"Implementation of reverse multiplication method.\"\"\"\n-        return a.__mul__(self)\n+        \"\"\"Implementation of reverse multiplication method.\n+\n+        Try the left operand's __mul__ first. However, for some SymPy numeric\n+        types (e.g. Float, Integer) __mul__ will produce a Mul expression\n+        containing the GeometryEntity instead of returning NotImplemented.\n+        In that case we should use the GeometryEntity's own __mul__ so that\n+        number * Point behaves the same as Point * number (coordinate-wise\n+        multiplication).\n+        \"\"\"\n+        try:\n+            res = a.__mul__(self)\n+        except Exception:\n+            # If the left operand's __mul__ raised, fall back to entity's __mul__.\n+            return self.__mul__(a)\n+\n+        # If left operand doesn't know how to handle it, use entity's __mul__.\n+        if res is NotImplemented:\n+            return self.__mul__(a)\n+\n+        # If the left operand returned a Mul that contains this entity,\n+        # prefer the entity's __mul__ (e.g., 2.0*Point(...) should act like\n+        # Point.__mul__).\n+        try:\n+            from sympy.core.mul import Mul\n+            if isinstance(res, Mul) and res.has(self):\n+                return self.__mul__(a)\n+        except Exception:\n+            # If inspection fails for any reason, fall back to left operand's result.\n+            pass\n+\n+        return res\n \n     def __rsub__(self, a):\n         \"\"\"Implementation of reverse subtraction method.\"\"\"\ndiff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex 7c978c47be..63b419943c 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -216,6 +216,29 @@ def __add__(self, other):\n         try:\n             s, o = Point._normalize_dimension(self, Point(other, evaluate=False))\n         except TypeError:\n+            # If the left operand produced a Mul like (2.0*Point(...)),\n+            # Point(other) above will raise TypeError because it expects a\n+            # sequence of coordinates or a Point.  Detect the common case\n+            # where `other` is a Mul containing a Point factor and handle\n+            # it by delegating to the coordinate-wise multiplication path\n+            # (which Point.__mul__ already implements).\n+            try:\n+                from sympy.core.mul import Mul\n+            except Exception:\n+                Mul = None\n+            if (Mul is not None) and isinstance(other, Mul):\n+                # Separate the Point factor from the scalar factor(s).\n+                pt_factor = None\n+                scalar = S.One\n+                for a in other.args:\n+                    if hasattr(a, 'is_Point') and getattr(a, 'is_Point'):\n+                        pt_factor = a\n+                    else:\n+                        scalar = scalar * a\n+                if pt_factor is not None:\n+                    # use point * scalar (coordinate-wise multiplication)\n+                    return self + (pt_factor * scalar)\n+            # fallback: raise as before\n             raise GeometryError(\"Don't know how to add {} and a Point object\".format(other))\n \n         coords = [simplify(a + b) for a, b in zip(s, o)]\n"
  },
  "sphinx-doc__sphinx-9658": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "sphinx-doc__sphinx-9658",
    "model_patch": "diff --git a/sphinx/util/typing.py b/sphinx/util/typing.py\nindex 87707d48f..cbe5522da 100644\n--- a/sphinx/util/typing.py\n+++ b/sphinx/util/typing.py\n@@ -50,6 +50,24 @@ INVALID_BUILTIN_CLASSES = {\n }\n \n \n+def _format_pyrole(role: str, module: str, name: str, tilde: bool = False) -> str:\n+    \"\"\"Format a Sphinx py:role reference safely.\n+    If name is falsy, fall back to the module only (avoid producing a trailing dot).\n+    \"\"\"\n+    # prefer name if provided\n+    if name:\n+        if tilde:\n+            return f':py:{role}:`~{module}.{name}`'\n+        else:\n+            return f':py:{role}:`{module}.{name}`'\n+    else:\n+        # no name available -> fall back to module only\n+        if tilde:\n+            return f':py:{role}:`~{module}`'\n+        else:\n+            return f':py:{role}:`{module}`'\n+\n+\n # Text like nodes which are initialized with text and rawsource\n TextlikeNode = Union[nodes.Text, nodes.TextElement]\n \n@@ -168,9 +186,9 @@ def _restify_py37(cls: Optional[Type]) -> str:\n             text = restify(cls.__origin__)  # type: ignore\n         elif getattr(cls, '_name', None):\n             if cls.__module__ == 'typing':\n-                text = ':py:class:`~%s.%s`' % (cls.__module__, cls._name)\n+                text = _format_pyrole('class', cls.__module__, getattr(cls, '_name', None), tilde=True)\n             else:\n-                text = ':py:class:`%s.%s`' % (cls.__module__, cls._name)\n+                text = _format_pyrole('class', cls.__module__, getattr(cls, '_name', None), tilde=False)\n         else:\n             text = restify(cls.__origin__)\n \n@@ -190,12 +208,12 @@ def _restify_py37(cls: Optional[Type]) -> str:\n \n         return text\n     elif isinstance(cls, typing._SpecialForm):\n-        return ':py:obj:`~%s.%s`' % (cls.__module__, cls._name)\n+        return _format_pyrole('obj', cls.__module__, getattr(cls, '_name', None), tilde=True)\n     elif hasattr(cls, '__qualname__'):\n         if cls.__module__ == 'typing':\n-            return ':py:class:`~%s.%s`' % (cls.__module__, cls.__qualname__)\n+            return _format_pyrole('class', cls.__module__, getattr(cls, '__qualname__', None) or getattr(cls, '__name__', None), tilde=True)\n         else:\n-            return ':py:class:`%s.%s`' % (cls.__module__, cls.__qualname__)\n+            return _format_pyrole('class', cls.__module__, getattr(cls, '__qualname__', None) or getattr(cls, '__name__', None), tilde=False)\n     elif isinstance(cls, ForwardRef):\n         return ':py:class:`%s`' % cls.__forward_arg__\n     else:\n@@ -203,7 +221,7 @@ def _restify_py37(cls: Optional[Type]) -> str:\n         if cls.__module__ == 'typing':\n             return ':py:obj:`~%s.%s`' % (cls.__module__, cls.__name__)\n         else:\n-            return ':py:obj:`%s.%s`' % (cls.__module__, cls.__name__)\n+            return _format_pyrole('obj', cls.__module__, getattr(cls, '__name__', None), tilde=False)\n \n \n def _restify_py36(cls: Optional[Type]) -> str:\n@@ -275,13 +293,13 @@ def _restify_py36(cls: Optional[Type]) -> str:\n             return ':py:obj:`Union`'\n     elif hasattr(cls, '__qualname__'):\n         if cls.__module__ == 'typing':\n-            return ':py:class:`~%s.%s`' % (cls.__module__, cls.__qualname__)\n+            return _format_pyrole('class', cls.__module__, getattr(cls, '__qualname__', None) or getattr(cls, '__name__', None), tilde=True)\n         else:\n-            return ':py:class:`%s.%s`' % (cls.__module__, cls.__qualname__)\n+            return _format_pyrole('class', cls.__module__, getattr(cls, '__qualname__', None) or getattr(cls, '__name__', None), tilde=False)\n     elif hasattr(cls, '_name'):\n         # SpecialForm\n         if cls.__module__ == 'typing':\n-            return ':py:obj:`~%s.%s`' % (cls.__module__, cls._name)\n+            return _format_pyrole('obj', cls.__module__, getattr(cls, '_name', None), tilde=True)\n         else:\n             return ':py:obj:`%s.%s`' % (cls.__module__, cls._name)\n     elif hasattr(cls, '__name__'):\n@@ -289,7 +307,7 @@ def _restify_py36(cls: Optional[Type]) -> str:\n         if cls.__module__ == 'typing':\n             return ':py:obj:`~%s.%s`' % (cls.__module__, cls.__name__)\n         else:\n-            return ':py:obj:`%s.%s`' % (cls.__module__, cls.__name__)\n+            return _format_pyrole('obj', cls.__module__, getattr(cls, '__name__', None), tilde=False)\n     else:\n         # others (ex. Any)\n         if cls.__module__ == 'typing':\n"
  }
}