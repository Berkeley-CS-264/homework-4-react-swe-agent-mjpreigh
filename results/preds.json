{
  "psf__requests-2931": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "psf__requests-2931",
    "model_patch": "diff --git a/requests/models.py b/requests/models.py\nindex 9c624d3..8bce13c 100644\n--- a/requests/models.py\n+++ b/requests/models.py\n@@ -80,8 +80,10 @@ class RequestEncodingMixin(object):\n         if parameters are supplied as a dict.\n         \"\"\"\n \n-        if isinstance(data, (str, bytes)):\n+        if isinstance(data, str):\n             return to_native_string(data)\n+        elif isinstance(data, bytes):\n+            return data\n         elif hasattr(data, 'read'):\n             return data\n         elif hasattr(data, '__iter__'):\n"
  },
  "django__django-11179": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-11179",
    "model_patch": "diff --git a/django/db/models/deletion.py b/django/db/models/deletion.py\nindex 92fe4affb9..c033279bb2 100644\n--- a/django/db/models/deletion.py\n+++ b/django/db/models/deletion.py\n@@ -277,6 +277,9 @@ class Collector:\n             if self.can_fast_delete(instance):\n                 with transaction.mark_for_rollback_on_error():\n                     count = sql.DeleteQuery(model).delete_batch([instance.pk], self.using)\n+                # Ensure the instance's primary key is cleared after deletion so that\n+                # the Python object doesn't still appear to be tied to a DB row.\n+                setattr(instance, model._meta.pk.attname, None)\n                 return count, {model._meta.label: count}\n \n         with transaction.atomic(using=self.using, savepoint=False):\n"
  },
  "django__django-14053": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-14053",
    "model_patch": "Ensure post_process yields each original filename only once with final results.\n\nNo changes detected to generate a patch."
  },
  "sympy__sympy-24213": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "sympy__sympy-24213",
    "model_patch": "diff --git a/sympy/physics/units/unitsystem.py b/sympy/physics/units/unitsystem.py\nindex a436880c4b..30f00fbd0e 100644\n--- a/sympy/physics/units/unitsystem.py\n+++ b/sympy/physics/units/unitsystem.py\n@@ -175,7 +175,12 @@ def _collect_factor_and_dimension(self, expr):\n             for addend in expr.args[1:]:\n                 addend_factor, addend_dim = \\\n                     self._collect_factor_and_dimension(addend)\n-                if dim != addend_dim:\n+                                    # Use the dimension system to check for dimensional\n+                    # equivalence rather than structural equality. This allows\n+                    # composed dimensions that are equivalent (for example\n+                    # acceleration * time and velocity) to be treated as the\n+                    # same for the purpose of addition.\n+                    if not self.get_dimension_system().equivalent_dims(dim, addend_dim):\n                     raise ValueError(\n                         'Dimension of \"{}\" is {}, '\n                         'but it should be {}'.format(\n"
  },
  "django__django-13810": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-13810",
    "model_patch": "diff --git a/django/core/handlers/base.py b/django/core/handlers/base.py\nindex 8e8c3da06a..8833f35201 100644\n--- a/django/core/handlers/base.py\n+++ b/django/core/handlers/base.py\n@@ -50,12 +50,16 @@ class BaseHandler:\n             else:\n                 middleware_is_async = middleware_can_async\n             try:\n-                # Adapt handler, if needed.\n-                handler = self.adapt_method_mode(\n+                # Adapt handler for passing into the middleware, if needed.\n+                # Do not overwrite `handler` until the middleware has been\n+                # instantiated successfully. If the middleware raises\n+                # MiddlewareNotUsed during initialization, we must not mutate\n+                # the handler for subsequent middleware.\n+                adapted_handler = self.adapt_method_mode(\n                     middleware_is_async, handler, handler_is_async,\n                     debug=settings.DEBUG, name='middleware %s' % middleware_path,\n                 )\n-                mw_instance = middleware(handler)\n+                mw_instance = middleware(adapted_handler)\n             except MiddlewareNotUsed as exc:\n                 if settings.DEBUG:\n                     if str(exc):\n"
  },
  "django__django-7530": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-7530",
    "model_patch": "diff --git a/django/core/management/commands/makemigrations.py b/django/core/management/commands/makemigrations.py\nindex 0b39536f5b..e648880ef0 100644\n--- a/django/core/management/commands/makemigrations.py\n+++ b/django/core/management/commands/makemigrations.py\n@@ -105,7 +105,7 @@ class Command(BaseCommand):\n                     # At least one model must be migrated to the database.\n                     router.allow_migrate(connection.alias, app_label, model_name=model._meta.object_name)\n                     for app_label in consistency_check_labels\n-                    for model in apps.get_models(app_label)\n+                    for model in apps.get_app_config(app_label).get_models()\n             )):\n                 loader.check_consistent_history(connection)\n \n"
  },
  "django__django-10973": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-10973",
    "model_patch": "diff --git a/django/db/backends/postgresql/client.py b/django/db/backends/postgresql/client.py\nindex 7fca6eff30..cca7c84efa 100644\n--- a/django/db/backends/postgresql/client.py\n+++ b/django/db/backends/postgresql/client.py\n@@ -2,17 +2,9 @@ import os\n import signal\n import subprocess\n \n-from django.core.files.temp import NamedTemporaryFile\n from django.db.backends.base.client import BaseDatabaseClient\n \n \n-def _escape_pgpass(txt):\n-    \"\"\"\n-    Escape a fragment of a PostgreSQL .pgpass file.\n-    \"\"\"\n-    return txt.replace('\\\\', '\\\\\\\\').replace(':', '\\\\:')\n-\n-\n class DatabaseClient(BaseDatabaseClient):\n     executable_name = 'psql'\n \n@@ -34,38 +26,19 @@ class DatabaseClient(BaseDatabaseClient):\n             args += ['-p', str(port)]\n         args += [dbname]\n \n-        temp_pgpass = None\n         sigint_handler = signal.getsignal(signal.SIGINT)\n         try:\n+            env = None\n             if passwd:\n-                # Create temporary .pgpass file.\n-                temp_pgpass = NamedTemporaryFile(mode='w+')\n-                try:\n-                    print(\n-                        _escape_pgpass(host) or '*',\n-                        str(port) or '*',\n-                        _escape_pgpass(dbname) or '*',\n-                        _escape_pgpass(user) or '*',\n-                        _escape_pgpass(passwd),\n-                        file=temp_pgpass,\n-                        sep=':',\n-                        flush=True,\n-                    )\n-                    os.environ['PGPASSFILE'] = temp_pgpass.name\n-                except UnicodeEncodeError:\n-                    # If the current locale can't encode the data, let the\n-                    # user input the password manually.\n-                    pass\n+                # Pass the password to psql via the PGPASSWORD environment variable.\n+                env = os.environ.copy()\n+                env['PGPASSWORD'] = passwd\n             # Allow SIGINT to pass to psql to abort queries.\n             signal.signal(signal.SIGINT, signal.SIG_IGN)\n-            subprocess.check_call(args)\n+            subprocess.run(args, env=env, check=True)\n         finally:\n             # Restore the original SIGINT handler.\n             signal.signal(signal.SIGINT, sigint_handler)\n-            if temp_pgpass:\n-                temp_pgpass.close()\n-                if 'PGPASSFILE' in os.environ:  # unit tests need cleanup\n-                    del os.environ['PGPASSFILE']\n \n     def runshell(self):\n         DatabaseClient.runshell_db(self.connection.get_connection_params())\n"
  },
  "django__django-16662": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-16662",
    "model_patch": "diff --git a/django/db/migrations/writer.py b/django/db/migrations/writer.py\nindex a59f0c8dcb..6788dc9096 100644\n--- a/django/db/migrations/writer.py\n+++ b/django/db/migrations/writer.py\n@@ -175,7 +175,18 @@ class MigrationWriter:\n \n         # Sort imports by the package / module to be imported (the part after\n         # \"from\" in \"from ... import ...\" or after \"import\" in \"import ...\").\n-        sorted_imports = sorted(imports, key=lambda i: i.split()[1])\n+        # Sort imports into 'import X' lines first, then 'from X import ...' lines,\n+        # each group sorted by the package / module to be imported (the part after\n+        # \"from\" in \"from ... import ...\" or after \"import\" in \"import ...\").\n+        module_imports = sorted(\n+            [i for i in imports if i.startswith(\"import \")],\n+            key=lambda i: i.split()[1],\n+        )\n+        from_imports = sorted(\n+            [i for i in imports if i.startswith(\"from \")],\n+            key=lambda i: i.split()[1],\n+        )\n+        sorted_imports = module_imports + from_imports\n         items[\"imports\"] = \"\\n\".join(sorted_imports) + \"\\n\" if imports else \"\"\n         if migration_imports:\n             items[\"imports\"] += (\n"
  },
  "django__django-13297": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-13297",
    "model_patch": "*** Begin Patch\n*** Update File: django/views/generic/base.py\n@@\n def _wrap_url_kwargs_with_deprecation_warning(url_kwargs):\n     context_kwargs = {}\n     for key, value in url_kwargs.items():\n-        # Bind into function closure.\n-        @SimpleLazyObject\n-        def access_value(key=key, value=value):\n-            warnings.warn(\n-                'TemplateView passing URL kwargs to the context is '\n-                'deprecated. Reference %s in your template through '\n-                'view.kwargs instead.' % key,\n-                RemovedInDjango40Warning, stacklevel=2,\n-            )\n-            return value\n-        context_kwargs[key] = access_value\n+        # If the URL resolver provided a SimpleLazyObject, force evaluation\n+        # of the underlying value here. Returning a nested SimpleLazyObject\n+        # as the context value can cause issues (for example with DB\n+        # parameter binding when that value is used in queryset filters).\n+        # We still keep the deprecation warning lazy (emitted when the\n+        # context value is accessed).\n+        resolved_value = value\n+        try:\n+            if isinstance(value, SimpleLazyObject):\n+                # Force evaluation. For URL kwargs the underlying value is\n+                # generally a simple Python value (most commonly a string or\n+                # converted type), so str() is a safe way to force resolution\n+                # for proxy objects that only evaluate on access.\n+                try:\n+                    resolved_value = value._wrapped if hasattr(value, \"_wrapped\") else str(value)\n+                except Exception:\n+                    # Fall back to str() if direct access isn't available.\n+                    resolved_value = str(value)\n+        except Exception:\n+            resolved_value = value\n+\n+        # Bind into function closure.\n+        @SimpleLazyObject\n+        def access_value(key=key, value=resolved_value):\n+            warnings.warn(\n+                'TemplateView passing URL kwargs to the context is '\n+                'deprecated. Reference %s in your template through '\n+                'view.kwargs instead.' % key,\n+                RemovedInDjango40Warning, stacklevel=2,\n+            )\n+            return value\n+        context_kwargs[key] = access_value\n     return context_kwargs\n*** End Patch****\n\nNo changes detected to generate a patch."
  },
  "psf__requests-1921": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "psf__requests-1921",
    "model_patch": "diff --git a/requests/sessions.py b/requests/sessions.py\nindex a023e4e..3ca3d33 100644\n--- a/requests/sessions.py\n+++ b/requests/sessions.py\n@@ -42,6 +42,16 @@ def merge_setting(request_setting, session_setting, dict_class=OrderedDict):\n         return request_setting\n \n     if request_setting is None:\n+        # If the session-level setting is a mapping, return a filtered copy\n+        # that excludes keys set to None. This allows doing:\n+        #   session.headers['Accept-Encoding'] = None\n+        # to remove the default header instead of sending \"None\" as its value.\n+        if isinstance(session_setting, Mapping):\n+            filtered = dict_class(to_key_val_list(session_setting))\n+            for k, v in list(filtered.items()):\n+                if v is None:\n+                    del filtered[k]\n+            return filtered\n         return session_setting\n \n     # Bypass if not a dictionary (e.g. verify)\n@@ -54,8 +64,14 @@ def merge_setting(request_setting, session_setting, dict_class=OrderedDict):\n     merged_setting = dict_class(to_key_val_list(session_setting))\n     merged_setting.update(to_key_val_list(request_setting))\n \n-    # Remove keys that are set to None.\n+    # Remove keys that are set to None on the request (explicit deletions).\n     for (k, v) in request_setting.items():\n+        if v is None and k in merged_setting:\n+            del merged_setting[k]\n+\n+    # Also remove any keys that have a None value (for example if the session\n+    # provided the key set to None and the request did not override it).\n+    for (k, v) in list(merged_setting.items()):\n         if v is None:\n             del merged_setting[k]\n \n"
  },
  "astropy__astropy-7166": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "astropy__astropy-7166",
    "model_patch": "diff --git a/astropy/utils/misc.py b/astropy/utils/misc.py\nindex de3fb01d1..118d2293f 100644\n--- a/astropy/utils/misc.py\n+++ b/astropy/utils/misc.py\n@@ -528,12 +528,54 @@ class InheritDocstrings(type):\n                 not key.startswith('_'))\n \n         for key, val in dct.items():\n-            if (inspect.isfunction(val) and\n-                is_public_member(key) and\n-                val.__doc__ is None):\n+            if not is_public_member(key):\n+                continue\n+\n+            # Normal functions (instance methods)\n+            if inspect.isfunction(val):\n+                if val.__doc__ is None:\n+                    for base in cls.__mro__[1:]:\n+                        super_method = getattr(base, key, None)\n+                        if super_method is not None:\n+                            val.__doc__ = super_method.__doc__\n+                            break\n+                continue\n+\n+            # staticmethod or classmethod: unwrap to underlying function\n+            if isinstance(val, (staticmethod, classmethod)):\n+                func = val.__func__\n+                if getattr(func, '__doc__', None) is None:\n+                    for base in cls.__mro__[1:]:\n+                        super_method = getattr(base, key, None)\n+                        if super_method is None:\n+                            continue\n+                        if isinstance(super_method, (classmethod, staticmethod)):\n+                            base_func = super_method.__func__\n+                        else:\n+                            base_func = getattr(super_method, '__func__', super_method)\n+                        if getattr(base_func, '__doc__', None):\n+                            func.__doc__ = base_func.__doc__\n+                            break\n+                continue\n+\n+            # property: set the fget docstring from the base property's fget\n+            if isinstance(val, property):\n+                fget = val.fget\n+                if fget is not None and getattr(fget, '__doc__', None) is None:\n+                    for base in cls.__mro__[1:]:\n+                        super_prop = getattr(base, key, None)\n+                        if isinstance(super_prop, property) and super_prop.fget is not None:\n+                            base_doc = super_prop.fget.__doc__\n+                            if base_doc:\n+                                fget.__doc__ = base_doc\n+                                break\n+                continue\n+\n+            # Generic descriptor: if it has no doc, try to inherit from base\n+            if hasattr(val, '__get__') and getattr(val, '__doc__', None) is None:\n                 for base in cls.__mro__[1:]:\n                     super_method = getattr(base, key, None)\n-                    if super_method is not None:\n+                    if super_method is not None and getattr(super_method, '__doc__', None):\n                         val.__doc__ = super_method.__doc__\n                         break\n \n"
  },
  "django__django-14011": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-14011",
    "model_patch": "diff --git a/django/core/servers/basehttp.py b/django/core/servers/basehttp.py\nindex 14dab517c9..9238dcd714 100644\n--- a/django/core/servers/basehttp.py\n+++ b/django/core/servers/basehttp.py\n@@ -17,6 +17,7 @@ from django.core.exceptions import ImproperlyConfigured\n from django.core.handlers.wsgi import LimitedStream\n from django.core.wsgi import get_wsgi_application\n from django.utils.module_loading import import_string\n+from django.db import connections\n \n __all__ = ('WSGIServer', 'WSGIRequestHandler')\n \n@@ -117,6 +118,25 @@ class ServerHandler(simple_server.ServerHandler):\n         self.get_stdin()._read_limited()\n         super().close()\n \n+    def run(self, application):\n+        \"\"\"\n+        Run the WSGI application for this request.\n+\n+        Ensure that database connections are closed after the request is\n+        processed. This is important for threaded servers (ThreadedWSGIServer)\n+        so that per-thread DB connections don't remain open and interfere\n+        with test database teardown.\n+        \"\"\"\n+        try:\n+            super().run(application)\n+        finally:\n+            # Close all DB connections associated with this thread/request.\n+            try:\n+                connections.close_all()\n+            except Exception:\n+                # Don't let closing DB connections mask application errors.\n+                pass\n+\n \n class WSGIRequestHandler(simple_server.WSGIRequestHandler):\n     protocol_version = 'HTTP/1.1'\n"
  },
  "sympy__sympy-17655": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "sympy__sympy-17655",
    "model_patch": "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex 7c978c47be..aa2b6d2a4e 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -216,7 +216,30 @@ def __add__(self, other):\n         try:\n             s, o = Point._normalize_dimension(self, Point(other, evaluate=False))\n         except TypeError:\n-            raise GeometryError(\"Don't know how to add {} and a Point object\".format(other))\n+            # Try to handle scalar*Point expressions like 2*Point(...)\n+            # where `other` may be a Mul with a Point factor (e.g. Mul(2, Point2D(...))).\n+            try:\n+                if getattr(other, 'is_Mul', False):\n+                    point_arg = None\n+                    factor = S.One\n+                    for a in other.args:\n+                        if isinstance(a, Point):\n+                            # If there is more than one Point factor, give up.\n+                            if point_arg is not None:\n+                                point_arg = None\n+                                break\n+                            point_arg = a\n+                        else:\n+                            factor = factor * a\n+                    if point_arg is not None:\n+                        # scale the Point factor by the collected factor and proceed\n+                        s, o = Point._normalize_dimension(self, Point(point_arg * factor, evaluate=False))\n+                    else:\n+                        raise GeometryError(\"Don't know how to add {} and a Point object\".format(other))\n+                else:\n+                    raise GeometryError(\"Don't know how to add {} and a Point object\".format(other))\n+            except TypeError:\n+                raise GeometryError(\"Don't know how to add {} and a Point object\".format(other))\n \n         coords = [simplify(a + b) for a, b in zip(s, o)]\n         return Point(coords, evaluate=False)\n"
  },
  "sphinx-doc__sphinx-9230": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "sphinx-doc__sphinx-9230",
    "model_patch": "diff --git a/sphinx/ext/napoleon/docstring.py b/sphinx/ext/napoleon/docstring.py\nindex d8cb75a5f..c11ab5cbf 100644\n--- a/sphinx/ext/napoleon/docstring.py\n+++ b/sphinx/ext/napoleon/docstring.py\n@@ -266,8 +266,17 @@ class GoogleDocstring:\n         if parse_type:\n             match = _google_typed_arg_regex.match(before)\n             if match:\n-                _name = match.group(1).strip()\n-                _type = match.group(2)\n+                # Handle both \"name(type)\" and \"type(name)\" forms. If there\n+# is trailing text after the matched parentheses, treat that\n+# trailing text as the parameter name and reconstruct the\n+# type including the parentheses.\n+                    trailing = before[match.end():].strip()\n+                    if trailing:\n+                        _name = trailing\n+                        _type = '%s(%s)' % (match.group(1).strip(), match.group(2).strip())\n+                    else:\n+                        _name = match.group(1).strip()\n+                        _type = match.group(2).strip()\n \n         _name = self._escape_args_and_kwargs(_name)\n \n"
  },
  "scikit-learn__scikit-learn-26323": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "scikit-learn__scikit-learn-26323",
    "model_patch": "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex 4eddd12b1..eae68ff9f 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -303,6 +303,14 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also ensure the remainder estimator (if any and if it is an estimator)\n+        # receives the same output configuration. When set_output is called\n+        # before fit, the remainder estimator is available as self.remainder\n+        # but is not part of self.transformers; ensure we don't ignore it.\n+        rem = getattr(self, \"remainder\", None)\n+        if rem is not None and rem not in {\"passthrough\", \"drop\"}:\n+            _safe_set_output(rem, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n"
  },
  "django__django-12406": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-12406",
    "model_patch": "diff --git a/django/forms/widgets.py b/django/forms/widgets.py\nindex 40ac1d3162..29a0e3c6ce 100644\n--- a/django/forms/widgets.py\n+++ b/django/forms/widgets.py\n@@ -759,6 +759,20 @@ class RadioSelect(ChoiceWidget):\n     template_name = 'django/forms/widgets/radio.html'\n     option_template_name = 'django/forms/widgets/radio_option.html'\n \n+    def format_value(self, value):\n+        \"\"\"Return selected value(s) as a list.\n+\n+        RadioSelect is a single-choice widget. If the value is empty (None or\n+        empty string) and the widget is required, don't mark the empty choice\n+        as selected. Returning an empty list prevents the empty choice (value\n+        '') from being included in the selected values.\n+        \"\"\"\n+        # For required single-select radio widgets, an empty value shouldn't\n+        # cause the empty option to be selected by default.\n+        if (value is None or value == '') and not getattr(self, 'allow_multiple_selected', False) and getattr(self, 'is_required', False):\n+            return []\n+        return super().format_value(value)\n+\n \n class CheckboxSelectMultiple(ChoiceWidget):\n     allow_multiple_selected = True\n"
  },
  "sphinx-doc__sphinx-9658": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "sphinx-doc__sphinx-9658",
    "model_patch": "diff --git a/sphinx/util/typing.py b/sphinx/util/typing.py\nindex 87707d48f..caae459c1 100644\n--- a/sphinx/util/typing.py\n+++ b/sphinx/util/typing.py\n@@ -82,6 +82,16 @@ def get_type_hints(obj: Any, globalns: Dict = None, localns: Dict = None) -> Dic\n     from sphinx.util.inspect import safe_getattr  # lazy loading\n \n     try:\n+        # If this is a mocked object created by autodoc.mock, it may provide a\n+        # human-friendly display name in __display_name__.  Use that to avoid\n+        # producing results such as \"torch.nn.\" when the qualname is empty.\n+        display_name = getattr(cls, \"__display_name__\", None)\n+        if display_name and isinstance(display_name, str):\n+            # __display_name__ is stored as \"module.ClassName\" for mocked\n+            # classes (see sphinx.ext.autodoc.mock._make_subclass).  Use it\n+            # directly to form the :py:class: role text.\n+            return ':py:class:`%s`' % display_name\n+\n         return typing.get_type_hints(obj, globalns, localns)\n     except NameError:\n         # Failed to evaluate ForwardRef (maybe TYPE_CHECKING)\n"
  },
  "pytest-dev__pytest-7490": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "pytest-dev__pytest-7490",
    "model_patch": "diff --git a/src/_pytest/skipping.py b/src/_pytest/skipping.py\nindex 335e10996..050ab71e0 100644\n--- a/src/_pytest/skipping.py\n+++ b/src/_pytest/skipping.py\n@@ -239,16 +239,33 @@ def pytest_runtest_setup(item: Item) -> None:\n         skip(skipped.reason)\n \n     if not item.config.option.runxfail:\n-        item._store[xfailed_key] = xfailed = evaluate_xfail_marks(item)\n+        # Evaluate xfail marks here only to detect the special case of\n+        # run=False where the test must not be executed. Persist the\n+        # evaluation in the store only in that case so that later\n+        # re-evaluations (for example at report time) can still pick up\n+        # markers that were dynamically added during the call phase.\n+        xfailed = evaluate_xfail_marks(item)\n         if xfailed and not xfailed.run:\n+            item._store[xfailed_key] = xfailed\n             xfail(\"[NOTRUN] \" + xfailed.reason)\n+        else:\n+            # Ensure we don't leave a stale value in the store that would\n+            # prevent re-evaluation later (so dynamic markers can take effect).\n+            if xfailed_key in item._store:\n+                del item._store[xfailed_key]\n \n \n @hookimpl(hookwrapper=True)\n def pytest_runtest_call(item: Item) -> Generator[None, None, None]:\n     xfailed = item._store.get(xfailed_key, None)\n     if xfailed is None:\n-        item._store[xfailed_key] = xfailed = evaluate_xfail_marks(item)\n+        # Evaluate to detect run=False and possibly skip the call, but do\n+        # not persist the evaluation unless run=False. Persisting a\n+        # positive run=True evaluation would prevent a dynamic marker\n+        # added during the call from being noticed at report time.\n+        xfailed = evaluate_xfail_marks(item)\n+        if xfailed and not xfailed.run:\n+            item._store[xfailed_key] = xfailed\n \n     if not item.config.option.runxfail:\n         if xfailed and not xfailed.run:\n"
  },
  "django__django-16631": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "django__django-16631",
    "model_patch": "diff --git a/docs/howto/deployment/checklist.txt b/docs/howto/deployment/checklist.txt\nindex 75c9735e86..d393e4ad7a 100644\n--- a/docs/howto/deployment/checklist.txt\n+++ b/docs/howto/deployment/checklist.txt\n@@ -60,7 +60,9 @@ or from a file::\n     with open(\"/etc/secret_key.txt\") as f:\n         SECRET_KEY = f.read().strip()\n \n-If rotating secret keys, you may use :setting:`SECRET_KEY_FALLBACKS`::\n+If rotating secret keys, you may use :setting:`SECRET_KEY_FALLBACKS` to allow\n+previously-issued signed values to remain valid for a transitional period. For\n+example::\n \n     import os\n \n@@ -69,8 +71,13 @@ If rotating secret keys, you may use :setting:`SECRET_KEY_FALLBACKS`::\n         os.environ[\"OLD_SECRET_KEY\"],\n     ]\n \n-Ensure that old secret keys are removed from ``SECRET_KEY_FALLBACKS`` in a\n-timely manner.\n+Note that values in ``SECRET_KEY_FALLBACKS`` are used only to validate signed\n+data that was created with an old key; Django does not use fallback keys to\n+generate new signatures. Also, some code paths that call the underlying\n+``salted_hmac()`` function directly with the current :setting:`SECRET_KEY`\n+(for example certain session-related hashes) do not consult\n+``SECRET_KEY_FALLBACKS``. Remove old secret keys from ``SECRET_KEY_FALLBACKS``\n+once you are confident any signed values created with those keys have expired.\n \n :setting:`DEBUG`\n ----------------\ndiff --git a/docs/ref/settings.txt b/docs/ref/settings.txt\nindex 41387886c0..f7a431a73d 100644\n--- a/docs/ref/settings.txt\n+++ b/docs/ref/settings.txt\n@@ -2301,10 +2301,21 @@ Default: ``[]``\n A list of fallback secret keys for a particular Django installation. These are\n used to allow rotation of the ``SECRET_KEY``.\n \n-In order to rotate your secret keys, set a new ``SECRET_KEY`` and move the\n-previous value to the beginning of ``SECRET_KEY_FALLBACKS``. Then remove the\n-old values from the end of the ``SECRET_KEY_FALLBACKS`` when you are ready to\n-expire the sessions, password reset tokens, and so on, that make use of them.\n+When rotating secret keys, set a new ``SECRET_KEY`` and optionally add the\n+previous key(s) to ``SECRET_KEY_FALLBACKS`` temporarily so that signed values\n+created with the old key can still be validated for a transitional period.\n+\n+Note that values in ``SECRET_KEY_FALLBACKS`` are used only to *validate* signed\n+data that was created with an old key; Django does not use fallback keys to\n+generate new signatures. Only components that use Django's signing framework\n+(for example the cookie signer, :func:`django.core.signing.loads`/\n+:func:`django.core.signing.dumps`, and the built-in password reset tokens)\n+consult ``SECRET_KEY_FALLBACKS``. Code paths that call the underlying\n+``salted_hmac()`` function directly with the current :setting:`SECRET_KEY`\n+(for example, some session auth hashes) may not consult\n+``SECRET_KEY_FALLBACKS`` and can therefore be invalidated immediately when\n+``SECRET_KEY`` changes. Remove old values from ``SECRET_KEY_FALLBACKS`` once\n+you're confident any signed values created with those keys have expired.\n \n .. note::\n \ndiff --git a/docs/topics/auth/default.txt b/docs/topics/auth/default.txt\nindex c705abcb6b..79a8272b8c 100644\n--- a/docs/topics/auth/default.txt\n+++ b/docs/topics/auth/default.txt\n@@ -114,6 +114,18 @@ Django also provides :ref:`views <built-in-auth-views>` and :ref:`forms\n passwords.\n \n Changing a user's password will log out all their sessions. See\n+\n+.. note::\n+\n+    Rotating :setting:`SECRET_KEY` can affect various signed values used by\n+    the authentication system. You can add old keys to\n+    :setting:`SECRET_KEY_FALLBACKS` to allow validation of signatures created\n+    with previous keys, but fallback keys are *only* consulted by Django's\n+    signing framework. Some internal code paths that call\n+    ``salted_hmac()`` directly with :setting:`SECRET_KEY` (for example certain\n+    session-related hashes) may not consult fallbacks and may be invalidated\n+    immediately after rotation.\n+\n :ref:`session-invalidation-on-password-change` for details.\n \n Authenticating users\ndiff --git a/docs/topics/signing.txt b/docs/topics/signing.txt\nindex eaf1696b2c..534bedcbc3 100644\n--- a/docs/topics/signing.txt\n+++ b/docs/topics/signing.txt\n@@ -35,8 +35,16 @@ data -- it is vital you keep this secure, or attackers could use it to\n generate their own signed values.\n \n :setting:`SECRET_KEY_FALLBACKS` can be used to rotate secret keys. The\n-values will not be used to sign data, but if specified, they will be used to\n-validate signed data and must be kept secure.\n+values will not be used to sign new data, but if specified they will be used\n+to validate signed data that was created with an older key and must be kept\n+secure.\n+\n+Note that not every use of :setting:`SECRET_KEY` consults\n+:setting:`SECRET_KEY_FALLBACKS`. Only components that rely on Django's\n+signing framework (for example the cookie signer, :func:`django.core.signing.loads`\n+and :func:`django.core.signing.dumps`, and the built-in password reset tokens)\n+will consult fallback keys. Code that calls ``salted_hmac()`` directly with\n+the current :setting:`SECRET_KEY` may not use fallback keys.\n \n Using the low-level API\n =======================\n"
  },
  "sphinx-doc__sphinx-7590": {
    "model_name_or_path": "gpt-5-mini",
    "instance_id": "sphinx-doc__sphinx-7590",
    "model_patch": "diff --git a/sphinx/domains/cpp.py b/sphinx/domains/cpp.py\nindex fe52d881d..f83e1e98e 100644\n--- a/sphinx/domains/cpp.py\n+++ b/sphinx/domains/cpp.py\n@@ -855,6 +855,28 @@ class ASTStringLiteral(ASTLiteral):\n         signode.append(nodes.Text(txt, txt))\n \n \n+\n+class ASTUserDefinedLiteral(ASTLiteral):\n+    \"\"\"\n+    Represents a user-defined literal (UDL). Stores the whole literal text\n+    (base literal plus ud-suffix), e.g. 1q_s, 6.0q_J, \"abc\"_s, 'a'_x.\n+    \"\"\"\n+    def __init__(self, data: str) -> None:\n+        self.data = data\n+\n+    def _stringify(self, transform: StringifyTransform) -> str:\n+        return self.data\n+\n+    def get_id(self, version: int) -> str:\n+        # Use a generic id for UDLs. Keep the literal as-is inside the id.\n+        return \"L%sE\" % self.data\n+\n+    def describe_signature(self, signode: TextElement, mode: str,\n+                           env: \"BuildEnvironment\", symbol: \"Symbol\") -> None:\n+        txt = str(self)\n+        signode.append(nodes.Text(txt, txt))\n+\n+\n class ASTCharLiteral(ASTLiteral):\n     def __init__(self, prefix: str, data: str) -> None:\n         self.prefix = prefix  # may be None when no prefix\n@@ -4662,12 +4684,29 @@ class DefinitionParser(BaseParser):\n                       integer_literal_re, octal_literal_re]:\n             pos = self.pos\n             if self.match(regex):\n+                # consume builtin integer/float suffixes like U, L, f, F, etc.\n                 while self.current_char in 'uUlLfF':\n                     self.pos += 1\n+                # If a user-defined literal suffix immediately follows (no space),\n+                # it is an identifier-style suffix (C++ ud-suffix).\n+                # ud-suffix: identifier -> [A-Za-z_][A-Za-z0-9_]*\n+                # Accept it only if it immediately follows the literal.\n+                if self.current_char is not None and re.match(r'[A-Za-z_]', self.current_char):\n+                    # consume identifier characters for ud-suffix\n+                    while self.current_char is not None and re.match(r'[A-Za-z0-9_]', self.current_char):\n+                        self.pos += 1\n+                    return ASTUserDefinedLiteral(self.definition[pos:self.pos])\n                 return ASTNumberLiteral(self.definition[pos:self.pos])\n \n         string = self._parse_string()\n         if string is not None:\n+            # string-literal may also have a user-defined literal suffix\n+            # if immediately followed by an identifier (no space).\n+            pos = self.pos\n+            if self.current_char is not None and re.match(r'[A-Za-z_]', self.current_char):\n+                while self.current_char is not None and re.match(r'[A-Za-z0-9_]', self.current_char):\n+                    self.pos += 1\n+                return ASTUserDefinedLiteral(self.definition[pos:self.pos])\n             return ASTStringLiteral(string)\n \n         # character-literal\n@@ -4675,6 +4714,15 @@ class DefinitionParser(BaseParser):\n             prefix = self.last_match.group(1)  # may be None when no prefix\n             data = self.last_match.group(2)\n             try:\n+                # character-literal may also have a ud-suffix immediately following\n+                # e.g. 'a'_suffix\n+                # after match, self.pos points after the char literal\n+                ud_start = self.pos\n+                if self.current_char is not None and re.match(r'[A-Za-z_]', self.current_char):\n+                    while self.current_char is not None and re.match(r'[A-Za-z0-9_]', self.current_char):\n+                        self.pos += 1\n+                    # return as user-defined literal including prefix+char+suffix\n+                    return ASTUserDefinedLiteral(self.definition[self.last_match.start():self.pos])\n                 return ASTCharLiteral(prefix, data)\n             except UnicodeDecodeError as e:\n                 self.fail(\"Can not handle character literal. Internal error was: %s\" % e)\n"
  }
}